import  pandas as pd
df=pd.read_excel("ibs_nps.xlsx")
all_data=df["bigrams"].dropna().tolist()
uni_data=df["unigrams"].dropna().tolist()
data1=pd.read_excel("datafetch.xlsx")
comments=[]
keywords=[]
status1=[]
freq=[]
uni_wrds=[]
uni_status=[]
uni_freq=[]
comment_punc_list=[]
import re
def fetch_data(comment):
    all_keywords=[]
    uni_keywords=[]
    for i ,j in enumerate(all_data):
        if j.lower() in comment.lower():
            all_keywords.append(j)
    status = True if len(all_keywords) > 0 else False
    comment_punct = [comment.lower()]
    comment_punct = list(map(lambda x: re.sub('[^A-Za-z\s]', '', x), comment_punct))
    for m ,n in enumerate(uni_data):
        if type(n) is str:
            if str(n).lower() in str(comment_punct[0]).lower():
                uni_keywords.append(n)
        status2 = True if len(uni_keywords) > 0 else False

    return all_keywords, comment, status, len(all_keywords),uni_keywords,status2,len(uni_keywords),comment_punct[0]



for i ,rows in data1.iterrows():
    j,comment,status, frequency,uni_keywrds,status2,freq2,commnt_punc=fetch_data(str(rows["Q_COMCAST_GLOBAL_LTR_COMMENT"]))
    comments.append(comment)
    keywords.append(j)
    status1.append(status)
    freq.append(frequency)
    uni_wrds.append(uni_keywrds)
    uni_status.append(status2)
    uni_freq.append(freq2)
    comment_punc_list.append(commnt_punc)
df = pd.DataFrame({"comments": comments,
                       "bigrams keywords": keywords,
                   "bigram status": status1,
                   "bigram frequency": freq,
                   "unigram keywords":uni_wrds,
                   "unigram status":uni_status,
                   "unigram frequency":uni_freq,
                   "trimmed sentence":comment_punc_list
                   })
new_df = pd.concat([data1, df], axis=1)
new_df.to_csv("updated_final_data.csv", index=False)
